(global["webpackJsonp"] = global["webpackJsonp"] || []).push([["pages/tabBar/home"],{

/***/ 79:
/*!********************************************************************************************!*\
  !*** G:/PHP_dev/340-paopaoji/V3/paopao-v3-uinapp/main.js?{"page":"pages%2FtabBar%2Fhome"} ***!
  \********************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(wx, createPage) {

var _interopRequireDefault = __webpack_require__(/*! @babel/runtime/helpers/interopRequireDefault */ 4);
__webpack_require__(/*! uni-pages */ 26);
var _vue = _interopRequireDefault(__webpack_require__(/*! vue */ 25));
var _home = _interopRequireDefault(__webpack_require__(/*! ./pages/tabBar/home.vue */ 80));
// @ts-ignore
wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;
createPage(_home.default);
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/wx.js */ 1)["default"], __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */ 2)["createPage"]))

/***/ }),

/***/ 80:
/*!*************************************************************************!*\
  !*** G:/PHP_dev/340-paopaoji/V3/paopao-v3-uinapp/pages/tabBar/home.vue ***!
  \*************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _home_vue_vue_type_template_id_28aa9427_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./home.vue?vue&type=template&id=28aa9427&scoped=true& */ 81);
/* harmony import */ var _home_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./home.vue?vue&type=script&lang=js& */ 83);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _home_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _home_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__[key]; }) }(__WEBPACK_IMPORT_KEY__));
/* harmony import */ var _home_vue_vue_type_style_index_0_id_28aa9427_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./home.vue?vue&type=style&index=0&id=28aa9427&lang=scss&scoped=true& */ 86);
/* harmony import */ var _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */ 32);

var renderjs





/* normalize component */

var component = Object(_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__["default"])(
  _home_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],
  _home_vue_vue_type_template_id_28aa9427_scoped_true___WEBPACK_IMPORTED_MODULE_0__["render"],
  _home_vue_vue_type_template_id_28aa9427_scoped_true___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  "28aa9427",
  null,
  false,
  _home_vue_vue_type_template_id_28aa9427_scoped_true___WEBPACK_IMPORTED_MODULE_0__["components"],
  renderjs
)

component.options.__file = "pages/tabBar/home.vue"
/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ 81:
/*!********************************************************************************************************************!*\
  !*** G:/PHP_dev/340-paopaoji/V3/paopao-v3-uinapp/pages/tabBar/home.vue?vue&type=template&id=28aa9427&scoped=true& ***!
  \********************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_template_id_28aa9427_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=template&id=28aa9427&scoped=true& */ 82);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_template_id_28aa9427_scoped_true___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_template_id_28aa9427_scoped_true___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "recyclableRender", function() { return _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_template_id_28aa9427_scoped_true___WEBPACK_IMPORTED_MODULE_0__["recyclableRender"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "components", function() { return _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_template_id_28aa9427_scoped_true___WEBPACK_IMPORTED_MODULE_0__["components"]; });



/***/ }),

/***/ 82:
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!G:/PHP_dev/340-paopaoji/V3/paopao-v3-uinapp/pages/tabBar/home.vue?vue&type=template&id=28aa9427&scoped=true& ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "recyclableRender", function() { return recyclableRender; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "components", function() { return components; });
var components
try {
  components = {
    loginPopup: function () {
      return __webpack_require__.e(/*! import() | components/loginPopup/loginPopup */ "components/loginPopup/loginPopup").then(__webpack_require__.bind(null, /*! @/components/loginPopup/loginPopup.vue */ 730))
    },
  }
} catch (e) {
  if (
    e.message.indexOf("Cannot find module") !== -1 &&
    e.message.indexOf(".vue") !== -1
  ) {
    console.error(e.message)
    console.error("1. 排查组件名称拼写是否正确")
    console.error(
      "2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"
    )
    console.error(
      "3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件"
    )
  } else {
    throw e
  }
}
var render = function () {
  var _vm = this
  var _h = _vm.$createElement
  var _c = _vm._self._c || _h
  var l0 = _vm.__map(_vm.fishList, function (fish, index) {
    var $orig = _vm.__get_orig(fish)
    var m0 = _vm.formatHpPercentage(fish.currentHp, fish.originalHp)
    return {
      $orig: $orig,
      m0: m0,
    }
  })
  if (!_vm._isMounted) {
    _vm.e0 = function ($event) {
      _vm.bulletRechargeShow = true
    }
  }
  _vm.$mp.data = Object.assign(
    {},
    {
      $root: {
        l0: l0,
      },
    }
  )
}
var recyclableRender = false
var staticRenderFns = []
render._withStripped = true



/***/ }),

/***/ 83:
/*!**************************************************************************************************!*\
  !*** G:/PHP_dev/340-paopaoji/V3/paopao-v3-uinapp/pages/tabBar/home.vue?vue&type=script&lang=js& ***!
  \**************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--13-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=script&lang=js& */ 84);
/* harmony import */ var _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 84:
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--13-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!G:/PHP_dev/340-paopaoji/V3/paopao-v3-uinapp/pages/tabBar/home.vue?vue&type=script&lang=js& ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(uni) {

var _interopRequireDefault = __webpack_require__(/*! @babel/runtime/helpers/interopRequireDefault */ 4);
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _regenerator = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/regenerator */ 44));
var _asyncToGenerator2 = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ 46));
var _defineProperty2 = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/defineProperty */ 11));
var _toConsumableArray2 = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/toConsumableArray */ 18));
var _homeMixin = _interopRequireDefault(__webpack_require__(/*! ./mixin/homeMixin.js */ 85));
var _vuex = __webpack_require__(/*! vuex */ 35);
var _methods;
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//

var switchMp3 = 'https://www.img.xcooo.cn/uploads/2024/02/17887756404cea30.mp3';
var switchMusic = uni.createInnerAudioContext();
var bgMp3 = '';
var bgMusic = uni.createInnerAudioContext();

// 音频资源路径
var AUDIO_RESOURCES = {
  shoot: '../../static/sounds/shoot.mp3',
  laser: '../../static/sounds/laser.mp3',
  laser_2: '../../static/sounds/laser_2.mp3',
  boom: '../../static/sounds/boom.mp3',
  // 添加爆炸音效
  warning: '../../static/sounds/warning.mp3' // 添加警告音效
};
var BulletRechargeDialog = function BulletRechargeDialog() {
  __webpack_require__.e(/*! require.ensure | components/dialogs/BulletRechargeDialog */ "components/dialogs/BulletRechargeDialog").then((function () {
    return resolve(__webpack_require__(/*! @/components/dialogs/BulletRechargeDialog.vue */ 737));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var WeaponSwitchDialog = function WeaponSwitchDialog() {
  __webpack_require__.e(/*! require.ensure | components/dialogs/WeaponSwitchDialog */ "components/dialogs/WeaponSwitchDialog").then((function () {
    return resolve(__webpack_require__(/*! @/components/dialogs/WeaponSwitchDialog.vue */ 744));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var MyPrizesDialog = function MyPrizesDialog() {
  __webpack_require__.e(/*! require.ensure | components/dialogs/MyPrizesDialog */ "components/dialogs/MyPrizesDialog").then((function () {
    return resolve(__webpack_require__(/*! @/components/dialogs/MyPrizesDialog.vue */ 751));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var PowerReferenceDialog = function PowerReferenceDialog() {
  __webpack_require__.e(/*! require.ensure | components/dialogs/PowerReferenceDialog */ "components/dialogs/PowerReferenceDialog").then((function () {
    return resolve(__webpack_require__(/*! @/components/dialogs/PowerReferenceDialog.vue */ 758));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var FeedbackDialog = function FeedbackDialog() {
  __webpack_require__.e(/*! require.ensure | components/dialogs/FeedbackDialog */ "components/dialogs/FeedbackDialog").then((function () {
    return resolve(__webpack_require__(/*! @/components/dialogs/FeedbackDialog.vue */ 765));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var RechargeRulesDialog = function RechargeRulesDialog() {
  __webpack_require__.e(/*! require.ensure | components/dialogs/RechargeRulesDialog */ "components/dialogs/RechargeRulesDialog").then((function () {
    return resolve(__webpack_require__(/*! @/components/dialogs/RechargeRulesDialog.vue */ 772));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var Reward = function Reward() {
  __webpack_require__.e(/*! require.ensure | components/dialogs/Reward */ "components/dialogs/Reward").then((function () {
    return resolve(__webpack_require__(/*! @/components/dialogs/Reward.vue */ 779));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var BulletWarningDialog = function BulletWarningDialog() {
  __webpack_require__.e(/*! require.ensure | components/dialogs/BulletWarningDialog */ "components/dialogs/BulletWarningDialog").then((function () {
    return resolve(__webpack_require__(/*! @/components/dialogs/BulletWarningDialog.vue */ 786));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var HpTopAlert = function HpTopAlert() {
  __webpack_require__.e(/*! require.ensure | components/dialogs/HpTopAlert */ "components/dialogs/HpTopAlert").then((function () {
    return resolve(__webpack_require__(/*! @/components/dialogs/HpTopAlert.vue */ 793));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var CloudBackgroundLight = function CloudBackgroundLight() {
  __webpack_require__.e(/*! require.ensure | components/cloudBackground/CloudBackgroundLight */ "components/cloudBackground/CloudBackgroundLight").then((function () {
    return resolve(__webpack_require__(/*! @/components/cloudBackground/CloudBackgroundLight.vue */ 800));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var CloudBackgroundBlack = function CloudBackgroundBlack() {
  __webpack_require__.e(/*! require.ensure | components/cloudBackground/CloudBackgroundBlack */ "components/cloudBackground/CloudBackgroundBlack").then((function () {
    return resolve(__webpack_require__(/*! @/components/cloudBackground/CloudBackgroundBlack.vue */ 807));
  }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);
};
var _default = {
  name: 'home',
  components: {
    BulletRechargeDialog: BulletRechargeDialog,
    WeaponSwitchDialog: WeaponSwitchDialog,
    MyPrizesDialog: MyPrizesDialog,
    PowerReferenceDialog: PowerReferenceDialog,
    FeedbackDialog: FeedbackDialog,
    RechargeRulesDialog: RechargeRulesDialog,
    Reward: Reward,
    BulletWarningDialog: BulletWarningDialog,
    HpTopAlert: HpTopAlert,
    CloudBackgroundLight: CloudBackgroundLight,
    CloudBackgroundBlack: CloudBackgroundBlack
  },
  mixins: [_homeMixin.default],
  data: function data() {
    return {
      /* ==================== 用户信息 ==================== */
      userInfo: {
        coin: 0
      },
      localCoin: 0,
      // 添加本地子弹数量变量
      listData: [],
      /* ==================== 血量系统配置 ==================== */
      hpConfig: {
        warningThreshold: 15,
        // 血量警告阈值（百分比）
        initialDamageBonus: 0.15,
        // 前10发子弹的伤害加成（降低为15%）
        initialShotsCount: 10,
        // 初始高伤害子弹数量
        initialDamageTarget: 15 // 前10发子弹的目标血量百分比15
      },

      warnedFishIds: new Set(),
      // 记录已经触发过警告的鱼ID
      /* ==================== 游戏核心数据 ==================== */
      fishList: [],
      bullets: [],
      cannonAngle: 0,
      gameArea: {
        width: 0,
        height: 0,
        minX: 0,
        maxX: 0,
        minY: 0,
        maxY: 0
      },
      /* ==================== 缓存键名配置 ==================== */
      storageKeys: {
        localCoin: '_localCoin',
        localHp: '_localHp_'
      },
      /* ==================== 游戏配置参数 ==================== */
      maxBullets: 10,
      // 最多允许存在的子弹数
      moveInterval: null,
      lastFrameTime: 0,
      fps: 60,
      frameInterval: 1000 / 60,
      hitEffects: [],
      consecutiveShots: 0,
      lastShotTime: 0,
      consecutiveBonus: 0.1,
      sounds: {},
      isAudioLoaded: false,
      coinList: [],
      /* ==================== 充值相关 ==================== */
      coin: '',
      checkTimer: null,
      cancelTimer: null,
      pendingBulletCost: 0,
      // 待同步的子弹消耗
      lastConsumeTime: 0,
      // 上一次同步时间
      consumeTimer: null,
      // 定时器引用

      /* ==================== 游戏状态控制 ==================== */
      selectedFish: null,
      fireCooldown: 300,
      // 最短发射间隔
      gameLoopId: null,
      collisionCheckInterval: 50,
      // 碰撞检测间隔(ms)
      lastCollisionCheck: 0,
      /* ==================== 武器系统配置 ==================== */
      bulletSpeeds: {
        normal: 28,
        // 普通子弹速度
        laser: 18,
        // 激光炮速度
        shotgun: 16 // 散弹炮速度
      },

      bulletDamages: {
        normal: 1.8,
        // 普通子弹伤害系数
        laser: 2.0,
        // 激光炮伤害系数
        shotgun: 2.0 // 散弹炮单发伤害系数
      },

      /* ==================== 战斗系统配置 ==================== */
      consecutiveHitBonus: 0.1,
      // 连续命中加成
      lastHitTime: 0,
      // 上次命中时间
      consecutiveHits: 0,
      // 连续命中次数
      rapidFireBonus: 0.15,
      // 连发伤害加成
      lastFireTime: 0,
      // 上次发射时间
      rapidFireWindow: 300,
      // 连发时间窗口(ms)
      targetFish: null,
      // 当前目标鱼

      /* ==================== 速度控制系统 ==================== */
      speedControl: {
        normalSpeed: 1.0,
        // 正常移动速度
        lockedSpeed: 0.6,
        // 锁定目标后的移动速度
        bulletCollisionRadius: 35,
        // 子弹碰撞半径
        fishCollisionRadius: 40,
        // 鱼碰撞半径
        collisionPrecision: 0.8 // 碰撞检测精度(0-1)
      },

      /* ==================== 空间划分系统 ==================== */
      spatialGrid: {
        cellSize: 100,
        // 网格大小
        grid: {},
        // 网格数据
        autoAimThreshold: 15,
        // 自动瞄准阈值
        autoAimStrength: 0.3 // 自动瞄准强度
      },

      /* ==================== 碰撞系统配置 ==================== */
      collisionBox: {
        fishWidth: 90,
        // 增加鱼碰撞盒宽度
        fishHeight: 80,
        // 增加鱼碰撞盒高度
        bulletWidth: 40,
        // 增加子弹碰撞盒宽度
        bulletHeight: 40,
        // 增加子弹碰撞盒高度
        hitCompensation: 1.2,
        // 命中补偿系数
        rightSideBonus: 2.5,
        // 增加右侧命中加成
        spawnBonus: 2.8 // 新增：刚出现时的命中加成
      },

      /* ==================== 同步系统 ==================== */
      lastSyncTime: 0,
      // 上次同步时间
      syncInterval: 30000,
      // 同步间隔(30秒)
      syncTimer: null,
      // 同步定时器

      /* ==================== 炸弹系统配置 ==================== */
      bombConfig: {
        explosionRadius: 300,
        // 爆炸范围半径
        maxDamagePercent: 0.05,
        // 最大伤害比例（5%）
        minDamagePercent: 0.02 // 最小伤害比例（2%）
      },

      /* ==================== 特效系统配置 ==================== */
      hitEffectConfig: {
        flashDuration: 150,
        // 爆闪持续时间(ms)
        flashScale: 1.3,
        // 爆闪缩放比例
        flashOpacity: 0.9,
        // 爆闪透明度
        flashRadius: 100,
        // 爆闪范围(rpx)
        flashIntensity: 2.0,
        // 爆闪强度
        glowIntensity: 3.0,
        // 辉光强度
        flashCount: 3,
        // 连续爆闪次数
        flashInterval: 100,
        // 爆闪间隔时间(ms)
        maxEffects: 10,
        // 最大同时存在的特效数量
        effectPool: [] // 特效对象池
      },

      /* ==================== 对象池系统 ==================== */
      objectPools: {
        bullets: {
          pool: [],
          active: new Set(),
          maxSize: 50,
          // 最大池大小
          create: function create() {
            return {
              id: Date.now() + Math.random().toString(36).substr(2, 9),
              x: 0,
              y: 0,
              angle: 0,
              speed: 0,
              damage: 0,
              type: '',
              width: 0,
              height: 0,
              hitCount: 0,
              rapidFireMultiplier: 1,
              targetFish: null,
              lastUpdate: 0
            };
          },
          reset: function reset(obj) {
            obj.x = 0;
            obj.y = 0;
            obj.angle = 0;
            obj.speed = 0;
            obj.damage = 0;
            obj.type = '';
            obj.width = 0;
            obj.height = 0;
            obj.hitCount = 0;
            obj.rapidFireMultiplier = 1;
            obj.targetFish = null;
            obj.lastUpdate = 0;
            return obj;
          }
        },
        fish: {
          pool: [],
          active: new Set(),
          maxSize: 30,
          // 最大池大小
          create: function create() {
            return {
              id: Date.now() + Math.random().toString(36).substr(2, 9),
              x: 0,
              y: 0,
              scale: 1,
              rotation: 0,
              speed: 0,
              originalSpeed: 0,
              isCaught: false,
              isSelected: false,
              currentHp: 0,
              originalHp: 0,
              reward: 0,
              width: 0,
              height: 0,
              type: 1,
              isVisible: true
            };
          },
          reset: function reset(obj) {
            obj.x = 0;
            obj.y = 0;
            obj.scale = 1;
            obj.rotation = 0;
            obj.speed = 0;
            obj.originalSpeed = 0;
            obj.isCaught = false;
            obj.isSelected = false;
            obj.currentHp = 0;
            obj.originalHp = 0;
            obj.reward = 0;
            obj.width = 0;
            obj.height = 0;
            obj.type = 1;
            obj.isVisible = true;
            return obj;
          }
        }
      },
      /* ==================== 炸弹canvas配置 ==================== */
      explosionCanvas: null,
      explosionCtx: null,
      explosionParticles: [],
      canvasReady: false,
      canvasWidth: 0,
      canvasHeight: 0,
      /* ==================== 血量/子弹警告弹窗 ==================== */
      bulletWarningShow: false,
      hpWarningShow: false,
      currentWarningFish: null,
      /* ==================== 时间 ==================== */
      currentHour: new Date().getHours()
    };
  },
  onLoad: function onLoad(options) {
    // switchMusic.src = switchMp3
    var systemInfo = uni.getSystemInfoSync();
    // 初始化游戏区域尺寸
    this.gameArea.width = systemInfo.windowWidth;
    this.gameArea.height = systemInfo.windowHeight - this.tabBarHeight;
    this.gameArea.minX = 0;
    this.gameArea.maxX = this.gameArea.width;
    this.gameArea.minY = this.gameArea.height * 0.1; // 最小Y坐标（屏幕10%位置）
    this.gameArea.maxY = this.gameArea.height * 0.4; // 最大Y坐标（屏幕40%位置）

    // 初始化对象池
    this.clearPool('bullets');
    this.clearPool('fish');
    this.getRechargeList();
    this.getList({
      num: 1,
      size: 20
    });
    // 初始化空间划分
    this.initSpatialGrid();
  },
  onShow: function onShow() {
    var _this = this;
    // 初始化游戏状态（血条和子弹）
    this.initGameState();

    // 初始化音效
    this.initSounds();

    // 启动游戏
    this.startGameLoop();

    // 系统配置初始化
    this.$store.dispatch('getAppConfig').then(function (res) {
      var _res$data = res.data,
        site_title = _res$data.site_title,
        wx_group = _res$data.wx_group,
        app_logo = _res$data.app_logo,
        pop_con = _res$data.pop_con,
        is_epay = _res$data.is_epay,
        home_bg = _res$data.home_bg,
        normalSpeeds = _res$data.normalSpeeds,
        laserSpeeds = _res$data.laserSpeeds,
        shotgunSpeeds = _res$data.shotgunSpeeds,
        warningThreshold = _res$data.warningThreshold,
        initialShotsCount = _res$data.initialShotsCount;
      // 更新配置
      Object.assign(_this, {
        site_title: site_title,
        wx_group: wx_group,
        app_logo: app_logo,
        popContent: [pop_con],
        is_epay: is_epay,
        home_bg: home_bg
      });
      _this.bulletSpeeds.normal = normalSpeeds;
      _this.bulletSpeeds.laser = laserSpeeds;
      _this.bulletSpeeds.shotgun = shotgunSpeeds;
      _this.hpConfig.warningThreshold = warningThreshold;
      _this.hpConfig.initialShotsCount = initialShotsCount;
    });
  },
  onHide: function onHide() {
    // 停止游戏
    this.stopGameLoop();
    // 停止所有音效
    this.stopAllSounds();
    // 销毁音频实例
    this.destroySounds();
    // 清除同步定时器
    if (this.syncTimer) {
      clearTimeout(this.syncTimer);
      this.syncTimer = null;
    }
    // 同步最后一次子弹数量
    if (!this.isPaying) {
      this.initLocalCoin();
    }
    // 确保在页面销毁时清理所有对象池
    this.clearPool('bullets');
    this.clearPool('fish');
    clearTimeout(this.cancelTimer);
    clearInterval(this.checkTimer);
    // 取消订单检查
    this.cancelCheckPayStatus();
    this.loginVisible = false;
    console.log('页面隐藏事件');
  },
  onReady: function onReady() {
    var _this2 = this;
    // 在页面渲染完成后初始化Canvas
    setTimeout(function () {
      _this2.initExplosionCanvas();
    }, 100);
  },
  onUnload: function onUnload() {
    // console.log('页面隐藏2')
    // if (!this.isPaying) {
    //   this.initLocalCoin()
    // }
  },
  computed: {
    isMorning: function isMorning() {
      // 早上8点到下午5点为早晨，显示CloudBackgroundLight，其他时间显示CloudBackgroundBlack
      return this.currentHour >= 8 && this.currentHour < 17;
    }
  },
  methods: (_methods = {
    /* ==================== 二次开发优化请联系资深全栈开发QQ:602006050 ==================== */
    /* ==================== 游戏核心循环方法 ==================== */
    // 启动游戏主循环
    startGameLoop: function startGameLoop() {
      var _this3 = this;
      if (this.gameLoopId) {
        cancelAnimationFrame(this.gameLoopId);
      }
      var gameLoop = function gameLoop(timestamp) {
        // 计算时间增量
        var deltaTime = timestamp - _this3.lastFrameTime;
        _this3.lastFrameTime = timestamp;

        // 更新所有游戏对象
        _this3.updateAll(deltaTime);

        // 继续下一帧
        _this3.gameLoopId = requestAnimationFrame(gameLoop);
      };
      this.gameLoopId = requestAnimationFrame(gameLoop);
    },
    // 停止游戏主循环
    stopGameLoop: function stopGameLoop() {
      if (this.gameLoopId) {
        cancelAnimationFrame(this.gameLoopId);
        this.gameLoopId = null;
      }
    },
    // 统一更新所有游戏对象
    updateAll: function updateAll(deltaTime) {
      // 更新空间网格
      this.updateSpatialGrid();

      // 更新子弹位置
      this.updateBullets(deltaTime);

      // 更新鱼群位置
      this.updateFish(deltaTime);

      // 更新特效
      this.updateEffects(deltaTime);
    },
    // 更新所有子弹
    updateBullets: function updateBullets(deltaTime) {
      var now = performance.now();
      for (var i = this.bullets.length - 1; i >= 0; i--) {
        var bullet = this.bullets[i];
        if (bullet.type === 'laser') {
          if (now - bullet.lastUpdate < 16) continue;
          bullet.lastUpdate = now;
        }
        this.autoAimBullet(bullet);
        var rad = bullet.angle * Math.PI / 180;
        var moveDistance = bullet.speed * (deltaTime / 16.67);
        bullet.x += Math.sin(rad) * moveDistance;
        bullet.y -= Math.cos(rad) * moveDistance;
        if (bullet.x < -bullet.width || bullet.x > this.gameArea.width + bullet.width || bullet.y < -bullet.height || bullet.y > this.gameArea.height + bullet.height) {
          this.returnToPool('bullets', bullet);
          this.bullets.splice(i, 1);
          continue;
        }
        if (now - this.lastCollisionCheck >= this.collisionCheckInterval) {
          this.lastCollisionCheck = now;
          if (this.checkCollision(bullet)) {
            this.returnToPool('bullets', bullet);
            this.bullets.splice(i, 1);
          }
        }
      }
    },
    // 更新鱼群位置
    updateFish: function updateFish(deltaTime) {
      var screenWidth = this.gameArea.width;
      var minY = this.gameArea.minY;
      var maxY = this.gameArea.maxY;
      this.fishList.forEach(function (fish) {
        if (fish.isCaught) return;

        // 使用 deltaTime 计算移动距离
        var moveDistance = fish.speed * (deltaTime / 16.67); // 16.67ms 是 60fps 的帧时间
        fish.x -= moveDistance;

        // 如果鱼游出屏幕左边，重置位置到右边
        if (fish.x < -200) {
          fish.x = screenWidth + 100;
          fish.y = minY + Math.random() * (maxY - minY);
          // 不再重置血条，保持原有状态
          fish.isCaught = false;
          fish.isSelected = false;
          fish._isCaughtTemp = false;
        }
      });
    },
    // 更新特效
    updateEffects: function updateEffects(deltaTime) {
      for (var i = this.hitEffects.length - 1; i >= 0; i--) {
        var effect = this.hitEffects[i];
        effect.lifeTime -= deltaTime;
        if (effect.lifeTime <= 0) {
          this.resetEffect(effect);
          this.hitEffects.splice(i, 1);
        }
      }
    },
    /* ==================== 鱼群管理方法 ==================== */
    // 给鱼初始化位置、大小、速度、奖励等信息
    initFish: function initFish() {
      var _this4 = this;
      // 随机打乱奖品顺序
      var shuffledList = (0, _toConsumableArray2.default)(this.listData).sort(function () {
        return Math.random() - 0.5;
      });

      // 计算游戏区域边界
      var minY = this.gameArea.height * 0.1;
      var maxY = this.gameArea.height * 0.4;
      var screenWidth = this.gameArea.width;

      // 计算鱼群分布参数
      var rowCount = 3; // 3行
      var colCount = 4; // 4列
      var xSpacing = 200; // 水平间距
      var ySpacing = (maxY - minY) / (rowCount + 1); // 垂直间距

      this.fishList = shuffledList.map(function (fish, index) {
        // 计算行列位置
        var row = Math.floor(index / colCount);
        var col = index % colCount;

        // 基础位置计算
        var baseX = screenWidth + 100 + col * xSpacing;
        var baseY = minY + (row + 1) * ySpacing;

        // 添加随机偏移，使分布更自然
        var randomOffsetX = Math.random() * 50 - 25; // -25到25的随机偏移
        var randomOffsetY = Math.random() * 30 - 15; // -15到15的随机偏移

        // 保存原始速度
        var originalSpeed = (fish.speed || 1) * 0.5;
        var fishObj = _this4.getFromPool('fish');
        Object.assign(fishObj, _objectSpread(_objectSpread({}, fish), {}, {
          x: baseX + randomOffsetX,
          y: baseY + randomOffsetY,
          scale: 0.5 + Math.random() * 0.2,
          rotation: 180,
          speed: originalSpeed,
          originalSpeed: originalSpeed,
          isCaught: false,
          isSelected: false,
          currentHp: fish.hp,
          originalHp: fish.hp,
          reward: _this4.calculateReward(fish),
          width: fish.width || 100,
          height: fish.height || 100,
          type: fish.type || 1,
          isVisible: true
        }));
        return fishObj;
      });
    },
    calculateReward: function calculateReward(fish) {
      // 根据鱼的属性计算奖励
      var baseReward = fish.blood || 1;
      var dpsFactor = parseFloat(fish.dps) || 0.05;
      return Math.floor(baseReward * (1 + dpsFactor * 10));
    },
    // 选择鱼并瞄准
    selectFish: function selectFish(fish) {
      if (!this.userInfo.id) {
        this.loginVisible = true;
        return;
      }
      if (fish.isCaught) return;

      // 清除上一次选中
      if (this.selectedFish) {
        this.selectedFish.isSelected = false;
        // 恢复原始速度
        this.selectedFish.speed = this.selectedFish.originalSpeed;
      }

      // 设置当前鱼为选中
      this.selectedFish = fish;
      this.targetFish = fish;
      fish.isSelected = true;

      // 保存原始速度并降低速度
      if (!fish.originalSpeed) {
        fish.originalSpeed = fish.speed;
      }
      fish.speed = fish.originalSpeed * this.speedControl.lockedSpeed;

      // 获取鱼中心点坐标
      var fishCenterX = fish.x + (fish.width || 100) / 2;
      var fishCenterY = fish.y + (fish.height || 100) / 2;

      // 炮台位置
      var cannonX = Math.floor(this.gameArea.width / 2);
      var cannonY = this.gameArea.height - 100;

      // 计算精确角度
      var dx = fishCenterX - cannonX;
      var dy = fishCenterY - cannonY;
      var angle = Math.atan2(dx, -dy) * (180 / Math.PI);

      // 限制角度范围 [-60, 60]
      angle = Math.max(-60, Math.min(60, angle));

      // 设置炮台角度
      this.cannonAngle = angle;

      // 自动开火
      this.fire();
    },
    /* ==================== 子弹系统方法 ==================== */
    // 发射子弹前的检查
    checkAndFire: function checkAndFire() {
      var _this5 = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {
        return _regenerator.default.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!(_this5.localCoin <= 0)) {
                  _context.next = 3;
                  break;
                }
                _this5.bulletRechargeShow = true;
                return _context.abrupt("return", false);
              case 3:
                if (!(_this5.currentWeapon === 3 && _this5.localCoin < 3)) {
                  _context.next = 6;
                  break;
                }
                uni.showToast({
                  title: '子弹不足3发',
                  icon: 'none',
                  duration: 1500
                });
                return _context.abrupt("return", false);
              case 6:
                if (!(_this5.currentWeapon === 2 && _this5.localCoin < 10)) {
                  _context.next = 9;
                  break;
                }
                uni.showToast({
                  title: '子弹不足10发',
                  icon: 'none',
                  duration: 1500
                });
                return _context.abrupt("return", false);
              case 9:
                return _context.abrupt("return", true);
              case 10:
              case "end":
                return _context.stop();
            }
          }
        }, _callee);
      }))();
    },
    // 发射子弹前检查弹药，发射子弹并乐观扣除消耗，支持多种武器类型
    fire: function fire() {
      var _this6 = this;
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2() {
        var time, now, rapidFireMultiplier, bulletCost;
        return _regenerator.default.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                time = Date.now();
                if (!(time - _this6.lastShotTime < _this6.fireCooldown)) {
                  _context2.next = 3;
                  break;
                }
                return _context2.abrupt("return");
              case 3:
                _this6.lastShotTime = time;

                // 检查是否可以发射
                _context2.next = 6;
                return _this6.checkAndFire();
              case 6:
                if (_context2.sent) {
                  _context2.next = 8;
                  break;
                }
                return _context2.abrupt("return");
              case 8:
                if (!(_this6.localCoin <= 0)) {
                  _context2.next = 11;
                  break;
                }
                uni.showToast({
                  title: '子弹不足',
                  icon: 'none',
                  duration: 1500
                });
                return _context2.abrupt("return");
              case 11:
                // 计算连发加成
                now = Date.now();
                rapidFireMultiplier = 1;
                if (now - _this6.lastFireTime < _this6.rapidFireWindow) {
                  rapidFireMultiplier += _this6.rapidFireBonus;
                }
                _this6.lastFireTime = now;

                // 计算当前发射消耗
                bulletCost = 1;
                if (_this6.currentWeapon === 3) {
                  bulletCost = 3;
                } else if (_this6.currentWeapon === 2) {
                  bulletCost = 10;
                }

                // 检查子弹是否足够
                if (!(_this6.localCoin < bulletCost)) {
                  _context2.next = 20;
                  break;
                }
                uni.showToast({
                  title: '子弹不足',
                  icon: 'none',
                  duration: 1500
                });
                return _context2.abrupt("return");
              case 20:
                // 直接扣除本地子弹
                _this6.localCoin -= bulletCost;
                // 更新本地缓存
                uni.setStorageSync(_this6.siteBaseUrl + '_localCoin', {
                  count: _this6.localCoin,
                  updatedAt: Date.now()
                });

                // 播放音效
                // this.playSound('shoot')

                // 创建子弹
                if (_this6.currentWeapon === 2) {
                  _this6.createLaserBullet(rapidFireMultiplier);
                } else if (_this6.currentWeapon === 3) {
                  _this6.createShotgunBullets(rapidFireMultiplier);
                } else {
                  _this6.createNormalBullet(rapidFireMultiplier);
                }
              case 23:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2);
      }))();
    },
    createNormalBullet: function createNormalBullet() {
      var rapidFireMultiplier = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var normalBulletCount = this.bullets.filter(function (b) {
        return b.type === 'normal';
      }).length;
      if (normalBulletCount >= this.maxBullets) return;
      var bullet = this.getFromPool('bullets');
      Object.assign(bullet, {
        x: Math.floor(this.gameArea.width / 2),
        y: this.gameArea.height - 100,
        angle: this.cannonAngle,
        speed: this.bulletSpeeds.normal,
        damage: this.calculateDamage() * this.bulletDamages.normal * rapidFireMultiplier,
        type: 'normal-bullet',
        width: 20,
        height: 20,
        hitCount: 0,
        rapidFireMultiplier: rapidFireMultiplier,
        targetFish: this.targetFish,
        startX: Math.floor(this.gameArea.width / 2),
        startY: this.gameArea.height - 100
      });
      this.bullets.push(bullet);
      this.playSound('shoot');
    },
    createLaserBullet: function createLaserBullet() {
      var _this7 = this;
      var rapidFireMultiplier = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var laserCount = this.bullets.filter(function (b) {
        return b.type === 'laser';
      }).length;
      if (laserCount >= 3) return;
      var bullet = this.getFromPool('bullets');
      // 修改激光炮的初始位置计算
      var cannonX = Math.floor(this.gameArea.width / 2);
      var cannonY = this.gameArea.height - 100; // 调整发射位置

      Object.assign(bullet, {
        x: cannonX,
        y: cannonY,
        angle: this.cannonAngle,
        speed: this.bulletSpeeds.laser,
        damage: this.calculateDamage() * this.bulletDamages.laser * rapidFireMultiplier,
        type: 'laser',
        width: 40,
        // 增加宽度
        height: 300,
        pierceCount: 3,
        hitCount: 0,
        rapidFireMultiplier: rapidFireMultiplier,
        targetFish: this.targetFish,
        lastUpdate: performance.now()
      });
      this.bullets.push(bullet);
      setTimeout(function () {
        _this7.playSound('laser');
      }, 50);
    },
    createShotgunBullets: function createShotgunBullets() {
      var _this8 = this;
      var rapidFireMultiplier = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      [-1, 0, 1].forEach(function (offset, idx) {
        setTimeout(function () {
          var bullet = _this8.getFromPool('bullets');
          Object.assign(bullet, {
            x: Math.floor(_this8.gameArea.width / 2),
            y: _this8.gameArea.height - 100,
            angle: _this8.cannonAngle + offset * 15,
            speed: _this8.bulletSpeeds.shotgun,
            damage: _this8.calculateDamage() * _this8.bulletDamages.shotgun * rapidFireMultiplier,
            type: 'shotgun',
            width: 15,
            height: 15,
            hitCount: 0,
            rapidFireMultiplier: rapidFireMultiplier,
            targetFish: _this8.targetFish
          });
          _this8.bullets.push(bullet);
        }, idx * 100);
      });
      this.playSound('laser_2');
    },
    // 计算伤害值
    calculateDamage: function calculateDamage() {
      // 基础伤害值
      var baseDamage = 10;

      // 根据当前武器类型调整伤害
      switch (this.currentWeapon) {
        case 1:
          // 普通炮
          baseDamage = 10;
          break;
        case 2:
          // 激光炮
          baseDamage = 15;
          break;
        case 3:
          // 散弹炮
          baseDamage = 6;
          break;
      }

      // 计算连续发射加成
      var consecutiveBonus = this.consecutiveShots > 1 ? 1 + (this.consecutiveShots - 1) * this.consecutiveBonus : 1;

      // 计算最终伤害
      var finalDamage = Math.floor(baseDamage * consecutiveBonus);
      return finalDamage;
    },
    /* ==================== 碰撞检测方法 ==================== */
    // 通过简单圆碰撞检测子弹和鱼是否接触，触发击中特效和逻辑
    checkCollision: function checkCollision(bullet) {
      var now = performance.now();
      if (now - this.collisionBox.lastCheckTime < this.collisionBox.checkInterval) {
        return false;
      }
      this.collisionBox.lastCheckTime = now;
      var bulletX = bullet.x;
      var bulletY = bullet.y;

      // 如果是激光炮，调整碰撞检测逻辑
      if (bullet.type === 'laser') {
        // 计算激光炮的实际碰撞区域
        var laserLength = 300; // 激光长度
        var laserWidth = 60; // 增加激光宽度以提高命中率
        var rad = bullet.angle * Math.PI / 180;

        // 计算激光的终点
        var endX = bulletX + Math.sin(rad) * laserLength;
        var endY = bulletY - Math.cos(rad) * laserLength;

        // 检查目标鱼
        if (bullet.targetFish && !bullet.targetFish.isCaught) {
          var fish = bullet.targetFish;
          var fishCenterX = fish.x + (fish.width || 120);
          var fishCenterY = fish.y + (fish.height || 120);

          // 计算鱼到激光线的距离
          var distance = this.pointToLineDistance(fishCenterX, fishCenterY, bulletX, bulletY, endX, endY);

          // 如果距离小于激光宽度，则发生碰撞
          if (distance < laserWidth) {
            return this.handleBulletHit(bullet, fish, fishCenterX, fishCenterY);
          }
        }

        // 检查其他鱼
        for (var i = 0; i < this.fishList.length; i++) {
          var _fish = this.fishList[i];
          if (_fish.isCaught || _fish === bullet.targetFish) continue;
          var _fishCenterX = _fish.x + (_fish.width || 120);
          var _fishCenterY = _fish.y + (_fish.height || 120);

          // 计算鱼到激光线的距离
          var _distance = this.pointToLineDistance(_fishCenterX, _fishCenterY, bulletX, bulletY, endX, endY);

          // 如果距离小于激光宽度，则发生碰撞
          if (_distance < laserWidth) {
            return this.handleBulletHit(bullet, _fish, _fishCenterX, _fishCenterY);
          }
        }
      } else {
        // 原有的碰撞检测逻辑保持不变
        if (bullet.targetFish && !bullet.targetFish.isCaught) {
          var _fish2 = bullet.targetFish;
          var _fishCenterX2 = _fish2.x + (_fish2.width || 120);
          var _fishCenterY2 = _fish2.y + (_fish2.height || 120);
          var dx = _fishCenterX2 - bulletX;
          var dy = _fishCenterY2 - bulletY;
          var _distance2 = Math.sqrt(dx * dx + dy * dy);
          if (_distance2 < this.collisionBox.fishWidth) {
            return this.handleBulletHit(bullet, _fish2, bulletX, bulletY);
          }
        }
        for (var _i = 0; _i < this.fishList.length; _i++) {
          var _fish3 = this.fishList[_i];
          if (_fish3.isCaught || _fish3 === bullet.targetFish) continue;
          var _fishCenterX3 = _fish3.x + (_fish3.width || 120);
          var _fishCenterY3 = _fish3.y + (_fish3.height || 120);
          var _dx = _fishCenterX3 - bulletX;
          var _dy = _fishCenterY3 - bulletY;
          var _distance3 = Math.sqrt(_dx * _dx + _dy * _dy);
          if (_distance3 < this.collisionBox.fishWidth) {
            return this.handleBulletHit(bullet, _fish3, bulletX, bulletY);
          }
        }
      }
      return false;
    },
    // 添加点到线段距离的计算方法
    pointToLineDistance: function pointToLineDistance(x, y, x1, y1, x2, y2) {
      var A = x - x1;
      var B = y - y1;
      var C = x2 - x1;
      var D = y2 - y1;
      var dot = A * C + B * D;
      var len_sq = C * C + D * D;
      var param = -1;
      if (len_sq !== 0) {
        param = dot / len_sq;
      }
      var xx, yy;
      if (param < 0) {
        xx = x1;
        yy = y1;
      } else if (param > 1) {
        xx = x2;
        yy = y2;
      } else {
        xx = x1 + param * C;
        yy = y1 + param * D;
      }
      var dx = x - xx;
      var dy = y - yy;
      return Math.sqrt(dx * dx + dy * dy);
    },
    // 添加子弹命中处理方法
    handleBulletHit: function handleBulletHit(bullet, fish, bulletX, bulletY) {
      var _this9 = this;
      var now = Date.now();
      // 检查是否连续命中
      if (now - this.lastHitTime < 1000) {
        this.consecutiveHits++;
      } else {
        this.consecutiveHits = 1;
      }
      this.lastHitTime = now;

      // 触发连续爆闪效果
      if (fish.isSelected) {
        var flashCount = 0;
        var flashInterval = setInterval(function () {
          if (flashCount >= _this9.hitEffectConfig.flashCount) {
            clearInterval(flashInterval);
            fish.isHit = false;
            return;
          }
          fish.isHit = true;
          setTimeout(function () {
            fish.isHit = false;
          }, _this9.hitEffectConfig.flashDuration);
          flashCount++;
        }, this.hitEffectConfig.flashInterval);
      }

      // 计算连续命中加成
      var consecutiveBonus = 1 + (this.consecutiveHits - 1) * this.consecutiveHitBonus;
      var realRate = fish.real_rate || 100;
      var baseDamagePercent = 0.1;
      var damageEffectFn = null;
      var damageMultiplier = 1;

      // 测试员逻辑：level为1必中
      if (this.handleTestHit()) {
        baseDamagePercent = 1; // 设置100%伤害
        damageMultiplier = 999; // 设置极高的伤害倍率
      } else {
        // 初始化射击计数
        if (!fish.shotCount) {
          fish.shotCount = 0;
        }
        fish.shotCount++;

        // 根据子弹类型计算伤害
        switch (bullet.type) {
          case 'normal-bullet':
            if (fish.shotCount <= this.hpConfig.initialShotsCount) {
              var remainingHp = fish.currentHp / fish.originalHp * 100;
              var targetHp = this.hpConfig.initialDamageTarget;
              if (remainingHp <= targetHp) {
                var hitChance = realRate / 100;
                // 低概率时更容易出现不掉血或极小伤害
                if (Math.random() > hitChance || realRate <= 10 && Math.random() > 0.4) {
                  // 未命中时，有80%概率不掉血，20%概率造成极小伤害
                  baseDamagePercent = Math.random() > 0.8 ? 0.0001 : 0;
                } else {
                  // 根据real_rate计算伤害范围，使用更平滑的曲线
                  var damageRange;
                  if (realRate <= 10) {
                    // 低概率时，伤害范围更小且更均匀
                    var baseDamage = 0.0002 + realRate / 50000; // 基础伤害随概率缓慢增加
                    var randomFactor = Math.random() * 0.0003; // 随机波动范围
                    baseDamagePercent = baseDamage + randomFactor;
                  } else {
                    // 高概率时保持原有逻辑
                    var normalMin = 0.02;
                    var normalMax = 0.02 + realRate / 1250;
                    baseDamagePercent = normalMin + Math.random() * (normalMax - normalMin);
                  }
                  // 伤害倍率也使用更平滑的曲线
                  damageMultiplier = realRate <= 10 ? 1 + realRate / 1000 :
                  // 低概率时倍率增长更慢
                  1 + realRate / 80;
                }
              } else {
                var damageNeeded = remainingHp - targetHp;
                baseDamagePercent = damageNeeded / 100 / (this.hpConfig.initialShotsCount - fish.shotCount + 1);
                baseDamagePercent *= 1 + this.hpConfig.initialDamageBonus;
              }
            } else {
              var _hitChance = realRate / 100;
              if (Math.random() > _hitChance || realRate <= 10 && Math.random() > 0.4) {
                baseDamagePercent = Math.random() > 0.8 ? 0.0001 : 0;
              } else {
                var _damageRange;
                if (realRate <= 10) {
                  var _baseDamage = 0.0002 + realRate / 50000;
                  var _randomFactor = Math.random() * 0.0003;
                  baseDamagePercent = _baseDamage + _randomFactor;
                } else {
                  var _normalMin = 0.02;
                  var _normalMax = 0.02 + realRate / 1250;
                  baseDamagePercent = _normalMin + Math.random() * (_normalMax - _normalMin);
                }
                damageMultiplier = realRate <= 10 ? 1 + realRate / 1000 : 1 + realRate / 80;
              }
            }
            damageEffectFn = function damageEffectFn() {
              return _this9.addHitEffect(bulletX, bulletY);
            };
            break;
          case 'laser':
            if (fish.shotCount <= this.hpConfig.initialShotsCount) {
              var _remainingHp = fish.currentHp / fish.originalHp * 100;
              var _targetHp = this.hpConfig.initialDamageTarget;
              if (_remainingHp <= _targetHp) {
                var _hitChance2 = realRate / 100;
                if (Math.random() > _hitChance2 || realRate <= 10 && Math.random() > 0.4) {
                  baseDamagePercent = Math.random() > 0.8 ? 0.0001 : 0;
                } else {
                  if (realRate <= 10) {
                    // 激光炮在低概率时伤害略高于普通子弹
                    var _baseDamage2 = 0.0003 + realRate / 40000;
                    var _randomFactor2 = Math.random() * 0.0004;
                    baseDamagePercent = _baseDamage2 + _randomFactor2;
                  } else {
                    var laserMin = 0.025;
                    var laserMax = 0.025 + realRate / 1000;
                    baseDamagePercent = laserMin + Math.random() * (laserMax - laserMin);
                  }
                  damageMultiplier = realRate <= 10 ? 1.2 + realRate / 1000 : 1.2 + realRate / 60;
                }
              } else {
                var _damageNeeded = _remainingHp - _targetHp;
                baseDamagePercent = _damageNeeded / 100 / (this.hpConfig.initialShotsCount - fish.shotCount + 1);
                baseDamagePercent *= 1 + this.hpConfig.initialDamageBonus;
              }
            } else {
              var _hitChance3 = realRate / 100;
              if (Math.random() > _hitChance3 || realRate <= 10 && Math.random() > 0.4) {
                baseDamagePercent = Math.random() > 0.8 ? 0.0001 : 0;
              } else {
                if (realRate <= 10) {
                  var _baseDamage3 = 0.0003 + realRate / 40000;
                  var _randomFactor3 = Math.random() * 0.0004;
                  baseDamagePercent = _baseDamage3 + _randomFactor3;
                } else {
                  var _laserMin = 0.025;
                  var _laserMax = 0.025 + realRate / 1000;
                  baseDamagePercent = _laserMin + Math.random() * (_laserMax - _laserMin);
                }
                damageMultiplier = realRate <= 10 ? 1.2 + realRate / 1000 : 1.2 + realRate / 60;
              }
            }
            damageEffectFn = function damageEffectFn() {
              return _this9.addExplosionEffect(bulletX, bulletY, 1.2);
            };
            break;
          case 'shotgun':
            if (fish.shotCount <= this.hpConfig.initialShotsCount) {
              var _remainingHp2 = fish.currentHp / fish.originalHp * 100;
              var _targetHp2 = this.hpConfig.initialDamageTarget;
              if (_remainingHp2 <= _targetHp2) {
                var _hitChance4 = realRate / 100;
                if (Math.random() > _hitChance4 || realRate <= 10 && Math.random() > 0.4) {
                  baseDamagePercent = Math.random() > 0.8 ? 0.0001 : 0;
                } else {
                  if (realRate <= 10) {
                    // 散弹炮在低概率时伤害略低于普通子弹
                    var _baseDamage4 = 0.00015 + realRate / 60000;
                    var _randomFactor4 = Math.random() * 0.00025;
                    baseDamagePercent = _baseDamage4 + _randomFactor4;
                  } else {
                    var shotgunMin = 0.015;
                    var shotgunMax = 0.015 + realRate / 1500;
                    baseDamagePercent = shotgunMin + Math.random() * (shotgunMax - shotgunMin);
                  }
                  damageMultiplier = realRate <= 10 ? 1 + realRate / 1000 : 1 + realRate / 90;
                }
              } else {
                var _damageNeeded2 = _remainingHp2 - _targetHp2;
                baseDamagePercent = _damageNeeded2 / 100 / (this.hpConfig.initialShotsCount - fish.shotCount + 1);
                baseDamagePercent *= 1 + this.hpConfig.initialDamageBonus;
              }
            } else {
              var _hitChance5 = realRate / 100;
              if (Math.random() > _hitChance5 || realRate <= 10 && Math.random() > 0.4) {
                baseDamagePercent = Math.random() > 0.8 ? 0.0001 : 0;
              } else {
                if (realRate <= 10) {
                  var _baseDamage5 = 0.00015 + realRate / 60000;
                  var _randomFactor5 = Math.random() * 0.00025;
                  baseDamagePercent = _baseDamage5 + _randomFactor5;
                } else {
                  var _shotgunMin = 0.015;
                  var _shotgunMax = 0.015 + realRate / 1500;
                  baseDamagePercent = _shotgunMin + Math.random() * (_shotgunMax - _shotgunMin);
                }
                damageMultiplier = realRate <= 10 ? 1 + realRate / 1000 : 1 + realRate / 90;
              }
            }
            damageEffectFn = function damageEffectFn() {
              return _this9.addExplosionEffect(bulletX, bulletY, 1);
            };
            break;
          case 'laser':
            // 激光炮也使用前10发子弹规则
            if (fish.shotCount <= this.hpConfig.initialShotsCount) {
              // 前10发子弹使用固定伤害计算
              var _remainingHp3 = fish.currentHp / fish.originalHp * 100;
              var _targetHp3 = this.hpConfig.initialDamageTarget;

              // 如果当前血量已经低于目标血量，使用真实概率计算
              if (_remainingHp3 <= _targetHp3) {
                // 根据real_rate计算命中概率
                var _hitChance6 = realRate / 100;
                if (Math.random() > _hitChance6 || realRate <= 10 && Math.random() > 0.3) {
                  // 未命中，造成极小伤害
                  baseDamagePercent = Math.random() > 0.7 ? 0.0001 : 0;
                } else {
                  // 命中，造成正常伤害
                  var _laserMin2 = realRate <= 10 ? 0.0003 : 0.025;
                  var _laserMax2 = realRate <= 10 ? 0.0003 + realRate / 2000 : 0.025 + realRate / 500;
                  baseDamagePercent = _laserMin2 + Math.random() * (_laserMax2 - _laserMin2);
                  damageMultiplier = realRate <= 10 ? 1.2 + realRate / 1000 : 1.2 + realRate / 50;
                }
              } else {
                // 计算需要造成的伤害
                var _damageNeeded3 = _remainingHp3 - _targetHp3;
                baseDamagePercent = _damageNeeded3 / 100 / (this.hpConfig.initialShotsCount - fish.shotCount + 1);
                baseDamagePercent *= 1 + this.hpConfig.initialDamageBonus;
              }
            } else {
              // 后续子弹使用真实概率计算
              var _hitChance7 = realRate / 100;
              if (Math.random() > _hitChance7 || realRate <= 10 && Math.random() > 0.3) {
                baseDamagePercent = Math.random() > 0.7 ? 0.0001 : 0;
              } else {
                var _laserMin3 = realRate <= 10 ? 0.0003 : 0.025;
                var _laserMax3 = realRate <= 10 ? 0.0003 + realRate / 2000 : 0.025 + realRate / 500;
                baseDamagePercent = _laserMin3 + Math.random() * (_laserMax3 - _laserMin3);
                damageMultiplier = realRate <= 10 ? 1.2 + realRate / 1000 : 1.2 + realRate / 50;
              }
            }
            damageEffectFn = function damageEffectFn() {
              return _this9.addExplosionEffect(bulletX, bulletY, 1.2);
            };
            break;
          case 'shotgun':
            // 散弹炮也使用前10发子弹规则
            if (fish.shotCount <= this.hpConfig.initialShotsCount) {
              // 前10发子弹使用固定伤害计算
              var _remainingHp4 = fish.currentHp / fish.originalHp * 100;
              var _targetHp4 = this.hpConfig.initialDamageTarget;

              // 如果当前血量已经低于目标血量，使用真实概率计算
              if (_remainingHp4 <= _targetHp4) {
                // 根据real_rate计算命中概率
                var _hitChance8 = realRate / 100;
                if (Math.random() > _hitChance8 || realRate <= 10 && Math.random() > 0.3) {
                  // 未命中，造成极小伤害
                  baseDamagePercent = Math.random() > 0.7 ? 0.0001 : 0;
                } else {
                  // 命中，造成正常伤害
                  var _shotgunMin2 = realRate <= 10 ? 0.0003 : 0.01;
                  var _shotgunMax2 = realRate <= 10 ? 0.0003 + realRate / 3000 : 0.01 + realRate / 1500;
                  baseDamagePercent = _shotgunMin2 + Math.random() * (_shotgunMax2 - _shotgunMin2);
                  damageMultiplier = realRate <= 10 ? 1 + realRate / 200 : 1 + realRate / 100;
                }
              } else {
                // 计算需要造成的伤害
                var _damageNeeded4 = _remainingHp4 - _targetHp4;
                baseDamagePercent = _damageNeeded4 / 100 / (this.hpConfig.initialShotsCount - fish.shotCount + 1);
                baseDamagePercent *= 1 + this.hpConfig.initialDamageBonus;
              }
            } else {
              // 后续子弹使用真实概率计算
              var _hitChance9 = realRate / 100;
              if (Math.random() > _hitChance9 || realRate <= 10 && Math.random() > 0.3) {
                baseDamagePercent = Math.random() > 0.7 ? 0.0001 : 0;
              } else {
                var _shotgunMin3 = realRate <= 10 ? 0.0003 : 0.01;
                var _shotgunMax3 = realRate <= 10 ? 0.0003 + realRate / 3000 : 0.01 + realRate / 1500;
                baseDamagePercent = _shotgunMin3 + Math.random() * (_shotgunMax3 - _shotgunMin3);
                damageMultiplier = realRate <= 10 ? 1 + realRate / 200 : 1 + realRate / 100;
              }
            }
            damageEffectFn = function damageEffectFn() {
              return _this9.addExplosionEffect(bulletX, bulletY, 1);
            };
            break;
        }
      }

      // 播放击中特效
      if (damageEffectFn) damageEffectFn();

      // 计算实际伤害（加入连续命中加成和连发加成）
      var adjustedDamagePercent = baseDamagePercent * damageMultiplier * consecutiveBonus * (bullet.rapidFireMultiplier || 1);
      var damage = fish.originalHp * adjustedDamagePercent;

      // 减血并保留两位小数
      fish.currentHp = Math.max(0, Math.round((fish.currentHp - damage) * 100) / 100);

      // 检查是否需要显示警告
      var hpPercentage = fish.currentHp / fish.originalHp * 100;
      if (hpPercentage <= this.hpConfig.warningThreshold && !this.warnedFishIds.has(fish.id)) {
        this.showHpWarning(fish);
        this.warnedFishIds.add(fish.id);
      }

      // 更新血条缓存
      this.updateLocalHp(fish);

      // 捕获判断
      if (fish.currentHp <= 0 && !fish._isCaughtTemp) {
        fish.isCaught = true;

        // 检查是否是炸弹鱼
        if (fish.type == 4) {
          this.handleBombExplosion(fish);
          return;
        }
        this.checkRealHit(fish);
      }

      // 增加命中计数
      bullet.hitCount++;

      // 根据子弹类型决定是否移除
      if (bullet.type === 'laser') {
        if (bullet.hitCount >= bullet.pierceCount) {
          return true; // 移除子弹
        }
      } else {
        return true; // 普通子弹和散弹直接移除
      }

      return false;
    },
    /* ==================== 特效系统方法 ==================== */
    // 从特效池获取特效对象
    getEffectFromPool: function getEffectFromPool() {
      var effect = this.hitEffectConfig.effectPool.find(function (e) {
        return !e.active;
      });
      if (!effect) {
        effect = {
          id: Date.now() + Math.random().toString(36).substr(2, 9),
          x: 0,
          y: 0,
          scale: 1,
          opacity: 1,
          particles: [],
          active: false,
          lifeTime: 0
        };
        this.hitEffectConfig.effectPool.push(effect);
      }
      return effect;
    },
    // 重置特效对象
    resetEffect: function resetEffect(effect) {
      effect.x = 0;
      effect.y = 0;
      effect.scale = 1;
      effect.opacity = 1;
      effect.particles = [];
      effect.active = false;
      effect.lifeTime = 0;
      return effect;
    },
    // 修改添加击中效果方法
    addHitEffect: function addHitEffect(x, y) {
      var _this10 = this;
      // 检查当前活跃特效数量
      var activeEffects = this.hitEffects.filter(function (e) {
        return e.active;
      }).length;
      if (activeEffects >= this.hitEffectConfig.maxEffects) {
        return; // 如果达到最大数量，直接返回
      }

      var effect = this.getEffectFromPool();
      effect.x = x;
      effect.y = y;
      effect.active = true;
      effect.lifeTime = 300; // 设置生命周期

      // 创建粒子效果
      for (var i = 0; i < 6; i++) {
        var angle = i * 60;
        var particle = {
          id: "".concat(effect.id, "-").concat(i),
          x: x,
          y: y,
          angle: angle,
          scale: 1,
          opacity: 1
        };
        effect.particles.push(particle);
      }

      // 添加到活跃特效列表
      this.hitEffects.push(effect);

      // 动画效果
      setTimeout(function () {
        effect.scale = 1.5;
        effect.opacity = 0;
        effect.particles.forEach(function (particle) {
          particle.scale = 0;
          particle.opacity = 0;
        });
      }, 50);

      // 移除效果
      setTimeout(function () {
        var index = _this10.hitEffects.findIndex(function (e) {
          return e.id === effect.id;
        });
        if (index !== -1) {
          _this10.hitEffects.splice(index, 1);
          _this10.resetEffect(effect);
        }
      }, 300);
    },
    // 修改添加爆炸效果方法
    addExplosionEffect: function addExplosionEffect(x, y) {
      var _this11 = this;
      var size = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      // 检查当前活跃特效数量
      var activeEffects = this.hitEffects.filter(function (e) {
        return e.active;
      }).length;
      if (activeEffects >= this.hitEffectConfig.maxEffects) {
        return; // 如果达到最大数量，直接返回
      }

      var effect = this.getEffectFromPool();
      effect.x = x;
      effect.y = y;
      effect.active = true;
      effect.lifeTime = 300;

      // 创建粒子效果
      var particleCount = Math.floor(8 * size);
      for (var i = 0; i < particleCount; i++) {
        var angle = i * (360 / particleCount);
        var particle = {
          id: "".concat(effect.id, "-").concat(i),
          x: x,
          y: y,
          angle: angle,
          scale: 1,
          opacity: 1
        };
        effect.particles.push(particle);
      }

      // 添加到活跃特效列表
      this.hitEffects.push(effect);

      // 动画效果
      setTimeout(function () {
        effect.scale = 2 * size;
        effect.opacity = 0;
        effect.particles.forEach(function (particle) {
          particle.scale = 0;
          particle.opacity = 0;
        });
      }, 50);

      // 移除效果
      setTimeout(function () {
        var index = _this11.hitEffects.findIndex(function (e) {
          return e.id === effect.id;
        });
        if (index !== -1) {
          _this11.hitEffects.splice(index, 1);
          _this11.resetEffect(effect);
        }
      }, 300);
    }
  }, (0, _defineProperty2.default)(_methods, "updateEffects", function updateEffects(deltaTime) {
    for (var i = this.hitEffects.length - 1; i >= 0; i--) {
      var effect = this.hitEffects[i];
      effect.lifeTime -= deltaTime;
      if (effect.lifeTime <= 0) {
        this.resetEffect(effect);
        this.hitEffects.splice(i, 1);
      }
    }
  }), (0, _defineProperty2.default)(_methods, "showCatchAnimation", function showCatchAnimation(fish) {
    var _this12 = this;
    // 创建捕获动画效果
    var catchEffect = {
      id: Date.now(),
      x: fish.x,
      y: fish.y,
      scale: 1,
      opacity: 1
    };
    this.hitEffects.push(catchEffect);

    // 动画效果
    requestAnimationFrame(function () {
      catchEffect.scale = 2;
      catchEffect.opacity = 0;
    });

    // 移除效果
    setTimeout(function () {
      var index = _this12.hitEffects.findIndex(function (e) {
        return e.id === catchEffect.id;
      });
      if (index !== -1) {
        _this12.hitEffects.splice(index, 1);
      }
    }, 500);
  }), (0, _defineProperty2.default)(_methods, "handleBombExplosion", function handleBombExplosion(fish) {
    // 播放爆炸音效
    this.playSound('boom');

    // 创建Canvas爆炸效果
    this.createCanvasExplosion(fish.x + 120, fish.y + 120);

    // 震动屏幕
    uni.vibrateLong();

    // 对周围鱼群造成范围伤害
    this.dealAreaDamage(fish.x + 120, fish.y + 120);

    // 重置炸弹状态
    fish.currentHp = fish.originalHp;
    fish.isCaught = false;
    fish.isSelected = false;
    fish._isCaughtTemp = false;
    fish.x = this.gameArea.width + 100;
    fish.y = this.gameArea.minY + Math.random() * (this.gameArea.maxY - this.gameArea.minY);
  }), (0, _defineProperty2.default)(_methods, "dealAreaDamage", function dealAreaDamage(centerX, centerY) {
    var _this13 = this;
    var _this$bombConfig = this.bombConfig,
      explosionRadius = _this$bombConfig.explosionRadius,
      maxDamagePercent = _this$bombConfig.maxDamagePercent,
      minDamagePercent = _this$bombConfig.minDamagePercent;
    this.fishList.forEach(function (fish) {
      if (fish.isCaught || fish._isCaughtTemp) return;

      // 计算鱼到爆炸中心的距离
      var fishCenterX = fish.x + 120;
      var fishCenterY = fish.y + 120;
      var dx = fishCenterX - centerX;
      var dy = fishCenterY - centerY;
      var distance = Math.sqrt(dx * dx + dy * dy);

      // 如果在爆炸范围内
      if (distance <= explosionRadius) {
        // 根据距离计算伤害比例（距离越近伤害越大）
        var damageRatio = maxDamagePercent - distance / explosionRadius * (maxDamagePercent - minDamagePercent);

        // 计算实际伤害
        var damage = fish.originalHp * damageRatio;

        // 造成伤害
        fish.currentHp = Math.max(0, fish.currentHp - damage);

        // 创建伤害效果
        _this13.addHitEffect(fishCenterX, fishCenterY);

        // 如果鱼被击毁
        if (fish.currentHp <= 0 && !fish._isCaughtTemp) {
          fish.isCaught = true;
          _this13.checkRealHit(fish);
        }
      }
    });
  }), (0, _defineProperty2.default)(_methods, "addBombExplosionEffect", function addBombExplosionEffect(x, y) {
    var _this14 = this;
    var effectId = "".concat(Date.now(), "-").concat(Math.random().toString(36).substr(2, 9));
    var effect = {
      id: effectId,
      x: x,
      y: y,
      scale: 1,
      opacity: 1,
      particles: [],
      type: 'bomb'
    };

    // 创建爆炸效果
    this.hitEffects.push(effect);

    // 创建更多的粒子效果
    var particleCount = 16; // 增加粒子数量
    for (var i = 0; i < particleCount; i++) {
      var angle = i * 360 / particleCount;
      var particle = {
        id: "".concat(effectId, "-").concat(i),
        x: x,
        y: y,
        angle: angle,
        scale: 1,
        opacity: 1,
        distance: 0
      };
      effect.particles.push(particle);
    }

    // 动画效果
    var duration = 1000; // 延长动画时间
    var startTime = Date.now();
    var animate = function animate() {
      var elapsed = Date.now() - startTime;
      var progress = Math.min(elapsed / duration, 1);

      // 爆炸效果缩放
      effect.scale = 1 + progress * 3;
      effect.opacity = 1 - progress;

      // 更新粒子
      effect.particles.forEach(function (particle) {
        particle.distance = progress * 200; // 增加扩散距离
        particle.scale = 1 - progress;
        particle.opacity = 1 - progress;
      });

      // 强制更新视图
      _this14.$forceUpdate();
      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        // 移除效果
        var index = _this14.hitEffects.findIndex(function (e) {
          return e.id === effect.id;
        });
        if (index !== -1) {
          _this14.hitEffects.splice(index, 1);
        }
      }
    };
    requestAnimationFrame(animate);
  }), (0, _defineProperty2.default)(_methods, "createShockwave", function createShockwave(x, y) {
    var _this15 = this;
    var shockwave = {
      id: "shockwave-".concat(Date.now()),
      x: x,
      y: y,
      scale: 0,
      opacity: 1
    };
    this.hitEffects.push(shockwave);

    // 冲击波动画
    var duration = 800;
    var startTime = Date.now();
    var animate = function animate() {
      var elapsed = Date.now() - startTime;
      var progress = Math.min(elapsed / duration, 1);

      // 冲击波扩散
      shockwave.scale = progress * 4;
      shockwave.opacity = 1 - progress;

      // 强制更新视图
      _this15.$forceUpdate();
      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        // 移除效果
        var index = _this15.hitEffects.findIndex(function (e) {
          return e.id === shockwave.id;
        });
        if (index !== -1) {
          _this15.hitEffects.splice(index, 1);
        }
      }
    };
    requestAnimationFrame(animate);
  }), (0, _defineProperty2.default)(_methods, "createExplosionParticles", function createExplosionParticles(x, y) {
    var _this16 = this;
    var particleCount = 30; // 增加粒子数量
    var particles = [];
    for (var i = 0; i < particleCount; i++) {
      var angle = i * 360 / particleCount;
      var speed = 2 + Math.random() * 3;
      var size = 10 + Math.random() * 20;
      var particle = {
        id: "particle-".concat(Date.now(), "-").concat(i),
        x: x,
        y: y,
        size: size,
        angle: angle,
        speed: speed,
        opacity: 1,
        scale: 1
      };
      particles.push(particle);
      this.hitEffects.push(particle);
    }

    // 粒子动画
    var duration = 1000;
    var startTime = Date.now();
    var animate = function animate() {
      var elapsed = Date.now() - startTime;
      var progress = Math.min(elapsed / duration, 1);
      particles.forEach(function (particle) {
        // 更新位置
        var rad = particle.angle * Math.PI / 180;
        particle.x += Math.cos(rad) * particle.speed * 5;
        particle.y += Math.sin(rad) * particle.speed * 5;

        // 更新大小和透明度
        particle.scale = 1 - progress;
        particle.opacity = 1 - progress;
      });

      // 强制更新视图
      _this16.$forceUpdate();
      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        // 移除所有粒子
        particles.forEach(function (particle) {
          var index = _this16.hitEffects.findIndex(function (e) {
            return e.id === particle.id;
          });
          if (index !== -1) {
            _this16.hitEffects.splice(index, 1);
          }
        });
      }
    };
    requestAnimationFrame(animate);
  }), (0, _defineProperty2.default)(_methods, "initSpatialGrid", function initSpatialGrid() {
    this.spatialGrid.grid = {};
    this.updateSpatialGrid();
  }), (0, _defineProperty2.default)(_methods, "updateSpatialGrid", function updateSpatialGrid() {
    var _this17 = this;
    // 清空网格
    this.spatialGrid.grid = {};

    // 将鱼放入对应网格
    this.fishList.forEach(function (fish) {
      if (fish.isCaught) return;
      var cellX = Math.floor(fish.x / _this17.spatialGrid.cellSize);
      var cellY = Math.floor(fish.y / _this17.spatialGrid.cellSize);
      var cellKey = "".concat(cellX, ",").concat(cellY);
      if (!_this17.spatialGrid.grid[cellKey]) {
        _this17.spatialGrid.grid[cellKey] = [];
      }
      _this17.spatialGrid.grid[cellKey].push(fish);
    });
  }), (0, _defineProperty2.default)(_methods, "getNearbyFish", function getNearbyFish(bullet) {
    var cellX = Math.floor(bullet.x / this.spatialGrid.cellSize);
    var cellY = Math.floor(bullet.y / this.spatialGrid.cellSize);
    var nearbyFish = new Set();

    // 检查3x3网格区域
    for (var dx = -1; dx <= 1; dx++) {
      for (var dy = -1; dy <= 1; dy++) {
        var cellKey = "".concat(cellX + dx, ",").concat(cellY + dy);
        var fishInCell = this.spatialGrid.grid[cellKey] || [];
        fishInCell.forEach(function (fish) {
          return nearbyFish.add(fish);
        });
      }
    }
    return Array.from(nearbyFish);
  }), (0, _defineProperty2.default)(_methods, "autoAimBullet", function autoAimBullet(bullet) {
    if (!bullet.targetFish || bullet.targetFish.isCaught) return;
    var fish = bullet.targetFish;
    var fishCenterX = fish.x + 120;
    var fishCenterY = fish.y + 120;

    // 计算子弹到目标鱼的距离
    var dx = fishCenterX - bullet.x;
    var dy = fishCenterY - bullet.y;
    var distance = Math.sqrt(dx * dx + dy * dy);

    // 如果距离小于阈值，进行自动瞄准
    if (distance < this.spatialGrid.autoAimThreshold) {
      // 计算目标角度
      var targetAngle = Math.atan2(dx, -dy) * (180 / Math.PI);

      // 平滑过渡到目标角度
      var angleDiff = targetAngle - bullet.angle;
      // 减小角度变化速度，使移动更平滑
      bullet.angle += angleDiff * (this.spatialGrid.autoAimStrength * 0.5);
    }
  }), (0, _defineProperty2.default)(_methods, "initSounds", function initSounds() {
    // 创建音频实例
    this.sounds = {
      shoot: uni.createInnerAudioContext(),
      laser: uni.createInnerAudioContext(),
      laser_2: uni.createInnerAudioContext(),
      boom: uni.createInnerAudioContext(),
      warning: uni.createInnerAudioContext() // 添加警告音效实例
    };

    // 设置音频源
    this.sounds.shoot.src = AUDIO_RESOURCES.shoot;
    this.sounds.laser.src = AUDIO_RESOURCES.laser;
    this.sounds.laser_2.src = AUDIO_RESOURCES.laser_2;
    this.sounds.boom.src = AUDIO_RESOURCES.boom;
    this.sounds.warning.src = AUDIO_RESOURCES.warning; // 设置警告音效源

    // 设置音频加载状态
    this.isAudioLoaded = true;
  }), (0, _defineProperty2.default)(_methods, "playSound", function playSound(soundName) {
    if (!this.isAudioLoaded || !this.sounds[soundName]) return;

    // 重置音频并播放
    this.sounds[soundName].stop();
    this.sounds[soundName].play();
  }), (0, _defineProperty2.default)(_methods, "stopAllSounds", function stopAllSounds() {
    Object.values(this.sounds).forEach(function (sound) {
      if (sound) {
        sound.stop();
      }
    });
  }), (0, _defineProperty2.default)(_methods, "destroySounds", function destroySounds() {
    Object.values(this.sounds).forEach(function (sound) {
      if (sound) {
        sound.destroy();
      }
    });
    this.sounds = {};
    this.isAudioLoaded = false;
  }), (0, _defineProperty2.default)(_methods, "getFromPool", function getFromPool(poolType) {
    var pool = this.objectPools[poolType];
    var obj;
    if (pool.pool.length > 0) {
      obj = pool.pool.pop();
    } else {
      obj = pool.create();
    }
    pool.active.add(obj);
    return obj;
  }), (0, _defineProperty2.default)(_methods, "returnToPool", function returnToPool(poolType, obj) {
    var pool = this.objectPools[poolType];
    if (pool.active.has(obj)) {
      pool.active.delete(obj);
      if (pool.pool.length < pool.maxSize) {
        pool.pool.push(pool.reset(obj));
      }
    }
  }), (0, _defineProperty2.default)(_methods, "clearPool", function clearPool(poolType) {
    var pool = this.objectPools[poolType];
    pool.pool = [];
    pool.active.clear();
  }), (0, _defineProperty2.default)(_methods, "initExplosionCanvas", function initExplosionCanvas() {
    if (this.canvasReady) return;
    try {
      // 获取系统信息
      var sysInfo = uni.getSystemInfoSync();
      this.canvasWidth = sysInfo.windowWidth;
      this.canvasHeight = sysInfo.windowHeight;

      // 创建Canvas上下文
      this.explosionCtx = uni.createCanvasContext('explosionCanvas', this);
      this.canvasReady = true;

      // console.log('Canvas initialized successfully');
    } catch (error) {
      // console.error('Canvas initialization error:', error);
    }
  }), (0, _defineProperty2.default)(_methods, "createCanvasExplosion", function createCanvasExplosion(x, y) {
    var _this18 = this,
      _this$explosionPartic;
    if (!this.canvasReady) {
      // console.log('Canvas not ready, retrying...');
      setTimeout(function () {
        _this18.createCanvasExplosion(x, y);
      }, 100);
      return;
    }
    var particleCount = 50;
    var particles = [];
    for (var i = 0; i < particleCount; i++) {
      var angle = i / particleCount * Math.PI * 2;
      var speed = 2 + Math.random() * 3;
      var size = 3 + Math.random() * 5;
      var color = this.getRandomExplosionColor();
      particles.push({
        x: x,
        y: y,
        vx: Math.cos(angle) * speed,
        vy: Math.sin(angle) * speed,
        size: size,
        color: color,
        alpha: 1,
        life: 1
      });
    }
    (_this$explosionPartic = this.explosionParticles).push.apply(_this$explosionPartic, particles);
    this.animateExplosion();
  }), (0, _defineProperty2.default)(_methods, "animateExplosion", function animateExplosion() {
    var _this19 = this;
    if (!this.canvasReady || !this.explosionCtx || this.explosionParticles.length === 0) return;
    try {
      // 清除画布
      this.explosionCtx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);

      // 更新和绘制粒子
      for (var i = this.explosionParticles.length - 1; i >= 0; i--) {
        var p = this.explosionParticles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.1;
        p.life -= 0.02;
        p.alpha = p.life;

        // 设置粒子样式
        this.explosionCtx.setFillStyle(p.color);
        this.explosionCtx.setGlobalAlpha(p.alpha);

        // 绘制粒子
        this.explosionCtx.beginPath();
        this.explosionCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        this.explosionCtx.fill();
        if (p.life <= 0) {
          this.explosionParticles.splice(i, 1);
        }
      }

      // 应用绘制
      this.explosionCtx.draw();

      // 继续动画
      if (this.explosionParticles.length > 0) {
        requestAnimationFrame(function () {
          return _this19.animateExplosion();
        });
      }
    } catch (error) {
      // console.error('Animation error:', error);
      this.explosionParticles = [];
    }
  }), (0, _defineProperty2.default)(_methods, "getRandomExplosionColor", function getRandomExplosionColor() {
    var colors = ['#ff0000',
    // 红色
    '#ff6600',
    // 橙色
    '#ffcc00',
    // 黄色
    '#ffffff' // 白色
    ];

    return colors[Math.floor(Math.random() * colors.length)];
  }), (0, _defineProperty2.default)(_methods, "fresh", function fresh() {
    var _arguments = arguments,
      _this20 = this;
    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {
      var flag;
      return _regenerator.default.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              flag = _arguments.length > 0 && _arguments[0] !== undefined ? _arguments[0] : 0;
              // 同步子弹
              _this20.initGameState();

              // 重置血条
              _this20.resetLocalHp();

              // 重置游戏状态
              _this20.score = 0;
              _this20.currentPower = _this20.maxPower;
              _this20.consecutiveShots = 0;

              // 清空子弹和效果
              _this20.bullets = [];
              _this20.hitEffects = [];
              _this20.listData = [];
              _this20.fishList = [];

              // 重置鱼群
              _this20.getList({
                num: 1,
                size: 20
              });
              _this20.initSounds();
              if (flag == 1) {
                uni.showToast({
                  title: '游戏已刷新',
                  icon: 'success'
                });
              }

              // 重置警告状态
              _this20.resetWarningState();
            case 14:
            case "end":
              return _context3.stop();
          }
        }
      }, _callee3);
    }))();
  }), (0, _defineProperty2.default)(_methods, "initGameState", function initGameState() {
    var _this21 = this;
    // const token = uni.getStorageSync('token');
    // if (!token) {
    //   uni.reLaunch({
    //     url: '/pages/tabBar/index'
    //   });
    //   return;
    // }

    // 获取用户信息, 初始化用户血条和子弹
    setTimeout(function () {
      _this21.$store.dispatch('getUserInfo').then(function (res) {
        if (res.code == 200) {
          _this21.userInfo = res.data;

          // 初始化血条
          if (_this21.userInfo.id) {
            var storageKey = _this21.siteBaseUrl + _this21.storageKeys.localHp + _this21.userInfo.id;
            var cachedHp = uni.getStorageSync(storageKey);
            if (cachedHp) {
              // 更新所有鱼的血条状态
              _this21.fishList.forEach(function (fish) {
                var fishHp = cachedHp[fish.id];
                if (fishHp) {
                  fish.currentHp = fishHp.hp;
                  fish.originalHp = fish.originalHp || fish.currentHp;
                }
              });
            }
          }

          // 初始化子弹
          _this21.syncBullets();
        }
      });
    }, 1000);
  }), (0, _defineProperty2.default)(_methods, "updateLocalHp", function updateLocalHp(fish) {
    if (!this.userInfo.id) return;
    var storageKey = this.siteBaseUrl + this.storageKeys.localHp + this.userInfo.id;
    var cachedHp = uni.getStorageSync(storageKey) || {};
    cachedHp[fish.id] = {
      hp: fish.currentHp,
      updatedAt: Date.now()
    };
    uni.setStorageSync(storageKey, cachedHp);
  }), (0, _defineProperty2.default)(_methods, "resetLocalHp", function resetLocalHp() {
    if (!this.userInfo.id) return;
    var storageKey = this.siteBaseUrl + this.storageKeys.localHp + this.userInfo.id;
    uni.removeStorageSync(storageKey);

    // 重置所有鱼的血条
    this.fishList.forEach(function (fish) {
      fish.currentHp = fish.originalHp;
    });
  }), (0, _defineProperty2.default)(_methods, "initLocalCoin", function initLocalCoin() {
    var _this22 = this;
    var token = uni.getStorageSync('token');
    if (!token) {
      // console.warn('未登录，跳过初始化');
      uni.reLaunch({
        url: '/pages/tabBar/index'
      });
      return;
    }
    this.$store.dispatch('getUserInfo').then(function (res) {
      _this22.userInfo = res.data;
      _this22.syncBullets(); // 主逻辑放到这里处理
    });
  }), (0, _defineProperty2.default)(_methods, "showHpWarning", function showHpWarning(fish) {
    this.currentWarningFish = fish;
    this.hpWarningShow = true;

    // 播放警告音效
    this.playSound('warning');
  }), (0, _defineProperty2.default)(_methods, "closeHpWarning", function closeHpWarning() {
    this.hpWarningShow = false;
    this.currentWarningFish = null;
  }), (0, _defineProperty2.default)(_methods, "confirmHpWarning", function confirmHpWarning() {
    if (this.currentWarningFish) {
      // 检查子弹是否足够
      if (this.localCoin <= 0) {
        this.bulletRechargeShow = true;
        this.closeHpWarning();
        return;
      }

      // 直接击爆当前鱼
      this.currentWarningFish.currentHp = 0;
      this.checkRealHit(this.currentWarningFish);
    }
    this.closeHpWarning();
  }), (0, _defineProperty2.default)(_methods, "resetWarningState", function resetWarningState() {
    this.warnedFishIds.clear();
    this.hpWarningShow = false;
    this.currentWarningFish = null;
  }), (0, _defineProperty2.default)(_methods, "formatHpPercentage", function formatHpPercentage(currentHp, originalHp) {
    var percentage = currentHp / originalHp * 100;
    if (percentage === 0 || percentage === 100) {
      return Math.round(percentage);
    }
    return percentage.toFixed(2);
  }), _methods)
};
exports.default = _default;
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */ 2)["default"]))

/***/ }),

/***/ 86:
/*!***********************************************************************************************************************************!*\
  !*** G:/PHP_dev/340-paopaoji/V3/paopao-v3-uinapp/pages/tabBar/home.vue?vue&type=style&index=0&id=28aa9427&lang=scss&scoped=true& ***!
  \***********************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_style_index_0_id_28aa9427_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=style&index=0&id=28aa9427&lang=scss&scoped=true& */ 87);
/* harmony import */ var _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_style_index_0_id_28aa9427_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_style_index_0_id_28aa9427_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_style_index_0_id_28aa9427_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_style_index_0_id_28aa9427_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_8_oneOf_1_1_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_2_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_sass_loader_dist_cjs_js_ref_8_oneOf_1_4_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_D_hbuilderx_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_home_vue_vue_type_style_index_0_id_28aa9427_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 87:
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!G:/PHP_dev/340-paopaoji/V3/paopao-v3-uinapp/pages/tabBar/home.vue?vue&type=style&index=0&id=28aa9427&lang=scss&scoped=true& ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin
    if(false) { var cssReload; }
  

/***/ })

},[[79,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/tabBar/home.js.map